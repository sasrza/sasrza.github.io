<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WearWeather™ v8.3</title>
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --accent-gold: #fbbf24;
        }

        body {
            margin: 0; padding: 20px; font-family: 'Inter', sans-serif;
            min-height: 100vh; display: flex; justify-content: center;
            transition: background 1s ease;
            background: #0f172a; /* Default Midnight */
            color: white;
            overflow-x: hidden;
        }

        /* Dynamic Themes */
        body.night { background: #020617; color: white; }
        body.day-clear { background: #38bdf8; color: white; }
        body.day-cloudy { background: #94a3b8; color: white; }
        body.day-rainy { background: #475569; color: white; }
        body.day-snowy { background: #e2e8f0; color: #1e293b; }

        .app-container { width: 100%; max-width: 480px; text-align: center; margin-top: 40px; }

        #location { 
            font-size: 42px; 
            margin: 0 0 40px 0; 
            text-transform: uppercase; 
            font-weight: 900; 
            letter-spacing: -1px;
            line-height: 1;
        }

        .weather-card {
            background: var(--glass-bg); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border); border-radius: 40px; padding: 50px 20px;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.5);
        }

        #glyph { font-size: 100px; margin-bottom: 20px; display: block; filter: drop-shadow(0 0 20px rgba(255,255,255,0.1)); }
        .temp-main { font-size: 96px; font-weight: 800; margin: 0; line-height: 0.9; }
        #description { font-size: 20px; text-transform: uppercase; letter-spacing: 3px; margin: 15px 0 30px 0; font-weight: 600; opacity: 0.9; }
        .aside-message { font-size: 16px; line-height: 1.5; margin-bottom: 40px; font-weight: 400; padding: 0 10px; }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .stat-box {
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border);
            border-radius: 24px; padding: 20px 5px; display: flex; flex-direction: column; gap: 8px;
        }
        .stat-box i { font-size: 20px; color: var(--accent-gold); }
        .stat-label { font-size: 10px; font-weight: 700; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 17px; font-weight: 700; }

        .footer { margin-top: 60px; font-size: 11px; opacity: 0.3; letter-spacing: 2px; font-weight: 700; }
    </style>

    <script>
   
const key = 'd0704da8612745131eda6e9b3ce8ebb5';

    async function getSilentLocation() {
        // Set a timeout so the app doesn't hang if the IP service is blocked
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 2000);

        try {
            // Using HTTPS is mandatory for iOS
            const response = await fetch('https://ipapi.co/json/', { signal: controller.signal });
            const data = await response.json();
            if(data.latitude && data.longitude) {
                weatherBallon(data.latitude, data.longitude);
            } else {
                throw new Error("Invalid IP data");
            }
        } catch (error) {
            console.log("IP lookup failed/blocked, requesting GPS...");
            requestGPS();
        }
    }

    function requestGPS() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (pos) => weatherBallon(pos.coords.latitude, pos.coords.longitude),
                (err) => {
                    document.getElementById('message-text').innerHTML = "Location access denied. Please check iPhone Settings > Safari.";
                },
                { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
            );
        }
    }

    function weatherBallon(lat, lon) {
        // Force HTTPS for the API call
        const url = `https://api.openweathermap.org/data/2.5/weather?units=imperial&lat=${lat}&lon=${lon}&appid=${key}`;
        
        fetch(url)
            .then(resp => {
                if (!resp.ok) throw new Error('Network response was not ok');
                return resp.json();
            })
            .then(data => drawWeather(data))
            .catch(err => {
                document.getElementById('message-text').innerHTML = "Weather data unavailable. Check your connection.";
            });
    }
        function drawWeather(d) {
            const desc = d.weather[0].description.toLowerCase();
            const hour = new Date().getHours();
            // Night is defined as 8pm to 5am
            const isNight = hour >= 20 || hour < 5;

            document.getElementById('location').innerHTML = d.name;
            document.getElementById('temp-num').innerHTML = Math.round(d.main.temp) + '&deg;';
            document.getElementById('description').innerHTML = desc;
            document.getElementById('feels-val').innerHTML = Math.round(d.main.feels_like) + '&deg;';
            document.getElementById('humid-val').innerHTML = d.main.humidity + '%';
            document.getElementById('wind-val').innerHTML = Math.round(d.wind.speed) + ' mph';

            let glyph = '';
            let message = '';
            let bgClass = '';

            // LOGIC PRIORITY: NIGHT FIRST
            if (isNight) {
                bgClass = 'night';
                glyph = '<i class="fas fa-moon"></i>';
                message = "It's night time in " + d.name + ". Sleep well!";
                if (desc.includes('snow')) {
                    glyph = '<i class="fas fa-snowflake"></i>';
                    message = "A snowy night. Stay warm inside!";
                } else if (desc.includes('rain')) {
                    glyph = '<i class="fas fa-cloud-moon-rain"></i>';
                    message = "Rainy night. Perfect for staying in.";
                }
            } 
            // DAYTIME LOGIC
            else {
                if (desc.includes('snow')) {
                    glyph = '<i class="fas fa-snowflake"></i>';
                    message = "Snowy day! Watch your step out there.";
                    bgClass = 'day-snowy';
                } else if (desc.includes('rain') || desc.includes('drizzle')) {
                    glyph = '<i class="fas fa-cloud-showers-heavy"></i>';
                    message = "It's raining. Don't forget your umbrella!";
                    bgClass = 'day-rainy';
                } else if (desc.includes('cloud')) {
                    glyph = '<i class="fas fa-cloud-sun"></i>';
                    message = "Cloudy skies today. A bit gray, but okay!";
                    bgClass = 'day-cloudy';
                } else {
                    glyph = '<i class="fas fa-sun"></i>';
                    message = "Bright and sunny! Enjoy the beautiful day.";
                    bgClass = 'day-clear';
                }
            }

            document.body.className = bgClass;
            document.getElementById('glyph').innerHTML = glyph;
            document.getElementById('message-text').innerHTML = message;
        }

        window.onload = getSilentLocation;
    </script>
</head>
<body>
    <div class="app-container">
        <header>
            <h1 id="location">LOADING...</h1>
        </header>

        <main class="weather-card">
            <div id="glyph"></div>
            <h2 id="temp-num" class="temp-main">--&deg;</h2>
            <p id="description">---</p>
            <div id="message-text" class="aside-message">Fetching local weather...</div>

            <div class="stats-grid">
                <div class="stat-box">
                    <i class="fas fa-thermometer-half"></i>
                    <span class="stat-label">Feels Like</span>
                    <span id="feels-val" class="stat-value">--&deg;</span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-tint"></i>
                    <span class="stat-label">Humidity</span>
                    <span id="humid-val" class="stat-value">--%</span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-wind"></i>
                    <span class="stat-label">Wind</span>
                    <span id="wind-val" class="stat-value">-- mph</span>
                </div>
            </div>
        </main>

        <footer class="footer">WEARWEATHER™ VERSION 8.3</footer>
    </div>
</body>
</html>
