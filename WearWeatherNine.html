<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>WearWeather™</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="./css/weather-icons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      width: 100%;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header, .footer {
      text-align: center;
      padding: 20px;
      font-weight: 600;
      font-size: 1.5rem;
    }
    .weather-section {
      text-align: center;
      padding: 30px 20px;
    }
    h1.weathericon { font-size: 120px; margin: 10px 0; }
    h1.weathercond { font-size: 40px; margin-bottom: 10px; }
    #temp { font-size: 32px; font-weight: 600; margin: 0; }
    #description { font-size: 20px; color: #555; }
    #feels { margin: 15px 0; font-size: 18px; }
    #whattowear { font-size: 18px; margin-top: 15px; }
    .error {
      color: red;
      margin-top: 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">WearWeather™</div>
    <div class="weather-section">
      <h1 class="weathericon" id="glyph"></h1>
      <h1 class="weathercond" id="location">Loading...</h1>
      <p id="temp"></p>
      <p id="description"></p>
      <p id="feels"></p>
      <p id="whattowear"></p>
      <p class="error" id="errorMsg"></p>
    </div>
    <div class="footer">Stay stylish & weather-ready</div>
  </div>

  <script>
  const key = "YOUR_REAL_OPENWEATHER_API_KEY";

  function randomMessage(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  async function getGeoByIP() {
    try {
      // Using ipapi.co (HTTPS) — free, no key needed for basic usage :contentReference[oaicite:0]{index=0}
      let resp = await fetch("https://ipapi.co/json/");
      if (!resp.ok) throw new Error("IP API lookup failed: " + resp.status);
      let j = await resp.json();
      if (!j.latitude || !j.longitude) {
        throw new Error("IP API returned no location");
      }
      return { lat: j.latitude, lon: j.longitude };
    } catch (err) {
      console.warn("IP geolocation failed:", err);
      throw err;
    }
  }

  function getGeoByBrowser() {
    return new Promise((resolve, reject) => {
      if (!navigator.geolocation) {
        reject(new Error("Browser geolocation not supported"));
      } else {
        navigator.geolocation.getCurrentPosition(pos => {
          resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude });
        }, err => {
          reject(err);
        });
      }
    });
  }

  async function getLocation() {
    // Try IP geolocation first
    try {
      return await getGeoByIP();
    } catch (ipErr) {
      // fallback to browser geolocation
      try {
        return await getGeoByBrowser();
      } catch (geoErr) {
        throw new Error("Cannot get location: " + geoErr.message);
      }
    }
  }

  async function weatherBallon(lat, lon) {
    try {
      let resp = await fetch(
        `https://api.openweathermap.org/data/2.5/weather?units=imperial&lat=${lat}&lon=${lon}&appid=${key}`
      );
      if (!resp.ok) {
        let text = await resp.text();
        throw new Error("OpenWeather HTTP error " + resp.status + ": " + text);
      }
      let data = await resp.json();
      if (data.cod && data.cod !== 200) {
        throw new Error("OpenWeather API error: " + data.message);
      }
      drawWeather(data);
    } catch (err) {
      console.error("weatherBallon error:", err);
      document.getElementById("errorMsg").innerText = err.message;
      document.getElementById("location").innerText = "Weather load failed";
    }
  }

  function drawWeather(d) {
    let temp = Math.round(d.main.temp);
    let feels = Math.round(d.main.feels_like);
    let humid = d.main.humidity;
    let wind = d.wind.speed;
    let desc = d.weather[0].description.toLowerCase();
    let name = d.name;

    document.getElementById("location").innerText = name;
    document.getElementById("temp").innerHTML = temp + "°F";
    document.getElementById("description").innerText =
      desc.charAt(0).toUpperCase() + desc.slice(1);

    // reset error
    document.getElementById("errorMsg").innerText = "";

    // Choose style & message based on weather
    if (desc.includes("rain")) {
      document.body.style.backgroundColor = "#DDE7F0";
      document.getElementById("glyph").innerHTML = '<i class="fas fa-cloud-showers-heavy"></i>';
      document.getElementById("feels").innerText = randomMessage([
        `Feels like ${feels}°F with ${humid}% humidity — better grab an umbrella.`,
        `Rainy out. It’s ${feels}°F, wind ${wind} mph.`,
        `Wet skies ahead. ${feels}°F, humidity ${humid}%.`
      ]);
    }
    else if (desc.includes("cloud")) {
      document.body.style.backgroundColor = "#ECECEC";
      document.getElementById("glyph").innerHTML = '<i class="wi wi-day-cloudy-high"></i>';
      document.getElementById("feels").innerText = randomMessage([
        `Overcast but calm. Feels like ${feels}°F.`,
        `Clouds rolling in. It's ${feels}°F, humidity ${humid}%.`,
        `Gray skies today. ${feels}°F with a breeze of ${wind} mph.`
      ]);
    }
    else if (desc.includes("snow")) {
      document.body.style.backgroundColor = "#F0FBFF";
      document.getElementById("glyph").innerHTML = '<i class="fas fa-snowflake"></i>';
      document.getElementById("feels").innerText = randomMessage([
        `Snow’s in the air! Feels like ${feels}°F.`,
        `Chilly & snowy. ${feels}°F, humidity ${humid}%.`,
        `Blanket of white ahead. ${feels}°F, winds ${wind} mph.`
      ]);
    }
    else {
      // clear
      document.body.style.backgroundColor = "#E0F7FF";
      document.getElementById("glyph").innerHTML = '<i class="fas fa-sun"></i>';
      document.getElementById("feels").innerText = randomMessage([
        `Sunny & bright. Feels like ${feels}°F.`,
        `Clear skies ahead. ${feels}°F, humidity ${humid}%.`,
        `Beautiful day. ${feels}°F with ${wind} mph breeze.`
      ]);
    }

    // Outfit suggestion
    let outfits = ["Nike Dri-Fit Tee", "Columbia Rain Jacket", "Adidas Hoodie", "Under Armour Shorts"];
    let pick = outfits[Math.floor(Math.random() * outfits.length)];
    document.getElementById("whattowear").innerHTML =
      `Consider: ${pick} <a href="https://www.amazon.com/s?k=${encodeURIComponent(pick)}" target="_blank"><i class="fab fa-amazon"></i></a>`;
  }

  (async function init() {
    try {
      let { lat, lon } = await getLocation();
      weatherBallon(lat, lon);
    } catch (err) {
      console.error("Init error:", err);
      document.getElementById("errorMsg").innerText = err.message;
      document.getElementById("location").innerText = "Cannot detect location";
    }
  })();
  </script>
</body>
</html>
